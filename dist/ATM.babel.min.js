"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e,t,a){return r.VALIDATE_RULES[e]?"function"==typeof r.VALIDATE_RULES[e]?r.VALIDATE_RULES[e](t,a):"object"===_typeof(r.VALIDATE_RULES[e])?(r.VALIDATE_RULES[e].requiredData=r.VALIDATE_RULES[e].requiredData||[],r.VALIDATE_RULES[e].requiredOptions=r.VALIDATE_RULES[e].requiredOptions||[],!r.VALIDATE_RULES[e].requiredData.some(function(e){return!t[e]&&console.warn("ATM validateData: Validate NOT passed, param: data."+e),!t[e]})&&!r.VALIDATE_RULES[e].requiredOptions.some(function(e){return!a[e]&&console.warn("ATM validateData: Validate NOT passed, param: options."+e),!a[e]})):(console.warn("ATM validateData: Type unmatched Please check your ATM_CONFIG.VALIDATE_RULES "),!1):(console.warn("ATM validateData: no matched validate rule, Please check your VALIDATE_RULES"),!1)}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.PROCESS_RULES[e]?"function"==typeof r.PROCESS_RULES[e]?r.PROCESS_RULES[e](t,a):"[object Array]"===Object.prototype.toString.call(r.PROCESS_RULES[e])?(r.PROCESS_RULES[e].forEach(function(e){void 0!==e.mergeOptionValue&&(t[e.mergeDataName]=a[e.mergeOptionValue]),void 0!==e.mergeOptionName&&(t[e.mergeDataName]=a[e.mergeOptionName])}),t):void 0:(console.warn("ATM validateData: no matched validate rule, Please check your PROCESS_RULES"),!1)}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r.REPORT_RULES[e]?r.REPORT_RULES[e](t,a):(console.warn("ATM validateData: no matched validate rule, Please check your REPORT_RULES"),!1)}var o={},r={VALIDATE_RULES:{piwik_emit:function(e,t){return!0},test:{requiredData:["test"],requiredOptions:[]},baidu_auto:{requiredData:[],requiredOptions:["trigger","page","element"]},google_auto:{requiredData:[],requiredOptions:["trigger","page","element"]},piwik_auto:{requiredData:[],requiredOptions:["trigger","page","element"]},default_auto:{requiredData:[],requiredOptions:["trigger","page","element"]},default_emit:{requiredData:[],requiredOptions:[]}},PROCESS_RULES:{piwik_emit:function(e,t){return e},piwik_auto:[{mergeDataName:"category",mergeOptionName:"page"},{mergeDataName:"action",mergeOptionName:"trigger"},{mergeDataName:"name",mergeOptionName:"element"},{mergeDataName:"value",mergeOptionValue:1}],default_auto:[{mergeDataName:"category",mergeOptionName:"page"},{mergeDataName:"action",mergeOptionName:"trigger"},{mergeDataName:"name",mergeOptionName:"element"},{mergeDataName:"value",mergeOptionValue:1}],default_emit:[]},REPORT_RULES:{default_emit:function(e,t){console.log("ATM report default_emit",e)},default_auto:function(e,t){console.log("ATM report default_auto",e);var a=setInterval(function(){if("undefined"!=typeof Piwik)try{var t=Piwik.getTracker();e.value?t.trackEvent(e.category,e.action,e.name,e.value):t.trackEvent(e.category,e.action,e.name)}catch(e){console.log("piwik 尚未加载")}finally{clearInterval(a)}},200)}}};o.autoCollectTrackData=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.validateRule=a.validateRule||"default_auto",a.processRule=a.processRule||"default_auto",a.reportRule=a.reportRule||"default_auto",!e(a.validateRule,t,a))return console.warn("ATM autoCollectTrackData: validateRule NOT passed"),!1;"*"===a.page&&(a.page=window.location.href.toLowerCase());var r=window.location.href.toLowerCase();try{if(-1!=r.indexOf(a.page))if("undefined"==typeof jQuery){var i=document.querySelectorAll(a.element);if(i){var n=Array.prototype.slice.call(i);n.forEach(function(e){e.addEventListener(a.trigger,function(){console.log(this),console.log("ATM.emitCollectingTrackData(data,options), native, Event Capture"),o.emitCollectingTrackData(t,a)})})}}else $(a.element).on(a.trigger,t,function(){console.log(this),console.log("ATM.emitCollectingTrackData(data,options) ,jQuery ,Event Capture"),o.emitCollectingTrackData(t,a)})}catch(e){console.log(e)}},o.emitCollectingTrackData=function(o,r){return!(!o&&!r)&&(r=r||{processRule:"default_emit",validateRule:"default_emit",reportRule:"default_emit"},r.validateRule||(r.validateRule="default_emit"),r.processRule||(r.processRule="default_emit"),r.reportRule||(r.reportRule="default_emit"),console.log("emitCollectingTrackData",o,r),!!e(r.validateRule,o,r)&&void("string"==typeof r.reportRule?(o=t(r.processRule,o,r))&&a(r.reportRule,o,r):"[object Array]"===Object.prototype.toString.call(r.reportRule)&&r.reportRule.forEach(function(e){var i=t(r.processRule,o,r);i&&a(e,i,r)})))},o.setOptions=function(e){console.log("setOptions:"),console.log("options: "+e),console.log("ATM_CONFIG: "+r)},window.ATM&&console.warn("ATM Fatal Error: window.ATM already exists, Please check"),window.ATM=window.ATM||o}();
//# sourceMappingURL=ATM.babel.min.js.map
